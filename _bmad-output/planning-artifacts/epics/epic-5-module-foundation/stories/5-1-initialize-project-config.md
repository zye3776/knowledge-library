# Story 5.1: Initialize Project Configuration

Status: ready

## Story

As a **knowledge library user**,
I want to initialize a new project with default configuration,
So that I can start using the tool immediately with sensible defaults.

## Background

The knowledge-library is a BMAD module that needs project-specific configuration. This story creates the initialization workflow that sets up the config file with defaults, creates the required directory structure, and validates the environment (yt-dlp installed, API keys configured).

## Acceptance Criteria

<acceptance_criteria>
1. **AC1:** Given a new project, when init is run, then a config.yaml file is created with sensible defaults
2. **AC2:** Given init runs, when complete, then the libraries/ directory is created for content storage
3. **AC3:** Given init runs, when complete, then required dependencies are checked (yt-dlp, OPENAI_API_KEY)
4. **AC4:** Given a dependency is missing, when init runs, then clear instructions are provided for resolution
5. **AC5:** Given config.yaml already exists, when init runs, then user is warned and can choose to reset or keep existing
</acceptance_criteria>

## Tasks

- [ ] **Task 1: Config file generation** (AC: 1, 5)
  - [ ] 1.1 Create config.yaml template with all options
  - [ ] 1.2 Populate with sensible defaults
  - [ ] 1.3 Add inline comments explaining each option
  - [ ] 1.4 Check for existing config and prompt user

- [ ] **Task 2: Directory structure** (AC: 2)
  - [ ] 2.1 Create libraries/ directory
  - [ ] 2.2 Create any other required directories
  - [ ] 2.3 Handle existing directories gracefully

- [ ] **Task 3: Dependency validation** (AC: 3, 4)
  - [ ] 3.1 Check if yt-dlp is installed and accessible
  - [ ] 3.2 Check if OPENAI_API_KEY environment variable is set
  - [ ] 3.3 Display status for each dependency
  - [ ] 3.4 Provide installation/configuration instructions for missing deps

## Technical Notes

<technical_notes>
**Default Config Template:**
```yaml
# Knowledge Library Configuration
# Generated by init command

# Output Directories
output:
  libraries: ./libraries    # Where processed content is stored

# TTS Settings
tts:
  voice: alloy              # OpenAI voice: alloy, echo, fable, onyx, nova, shimmer
  model: tts-1              # OpenAI model: tts-1, tts-1-hd
  speed: 1.0                # Playback speed: 0.25 to 4.0

# Processing Rules
processing:
  remove_sponsors: true     # Remove sponsor segments
  remove_visual_refs: true  # Remove unexplained visual references
  remove_ads: true          # Remove promotional content
```

**Init Output:**
```
=== Knowledge Library Initialization ===

Creating configuration...
✓ config.yaml created with defaults

Creating directories...
✓ libraries/ directory created

Checking dependencies...
✓ yt-dlp found (version 2024.12.01)
✓ OPENAI_API_KEY configured

Ready! Run /knowledge-library to start.
```

**Missing Dependency Message:**
```
✗ yt-dlp not found
  Install: brew install yt-dlp (macOS) or pip install yt-dlp

✗ OPENAI_API_KEY not set
  Set in your shell: export OPENAI_API_KEY="your-key"
```

**Existing Config Warning:**
```
⚠ config.yaml already exists

[K] Keep existing configuration
[R] Reset to defaults (backup current)
[X] Cancel
```
</technical_notes>

## Verification

<verification>
```bash
# AC1 Verification - Config created
test -f config.yaml && echo "PASS: config.yaml exists"
cat config.yaml | head -20 # Verify structure

# AC2 Verification - Directory created
test -d libraries && echo "PASS: libraries/ exists"

# AC3 Verification - Dependencies checked
which yt-dlp && echo "PASS: yt-dlp found"
test -n "$OPENAI_API_KEY" && echo "PASS: OPENAI_API_KEY set"

# AC4 Verification - Missing dep instructions
# Manual: Unset OPENAI_API_KEY, run init
# Expected: Clear instructions displayed

# AC5 Verification - Existing config handled
# Manual: Run init twice
# Expected: Warning displayed, user chooses action
```
</verification>

## Dependencies

- None (this is foundation)

## References

- [Epic Overview](../overview.md)
- [PRD FR18, FR21](/_bmad-output/planning-artifacts/prd.md)
