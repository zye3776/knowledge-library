---
name: kl
description: Knowledge Library main entry point. Initialize, browse, and manage your content library.
---

# Knowledge Library

Main entry point for the Knowledge Library module. Initialize projects, process content, and manage your library.

**Usage:** `/kl [command]`

## When to Use

- User wants to use the knowledge library
- Starting a new project or first-time setup
- Quick access to any knowledge library feature
- Checking project status or configuration

## Commands

| Command | Description |
|---------|-------------|
| `/kl` | Show main menu |
| `/kl init` | Initialize project with config.yaml |
| `/kl help` | Show detailed help |

## Instructions

<instructions>

### Route by Command

1. If argument is `init`, go to **Init Flow**
2. If argument is `help`, go to **Help Flow**
3. If no argument, go to **Main Menu Flow**

---

### Init Flow

#### Step I-1: Check for Existing Config

1. Check if `config.yaml` exists in the project root
2. If it exists, present options:
   ```
   config.yaml already exists.

   [K] Keep current config
   [R] Reset to defaults (overwrites current)
   [C] Cancel
   ```
3. If user selects Keep or Cancel, stop

#### Step I-2: Create Config File

1. Create `config.yaml` with this template:

```yaml
# Knowledge Library Configuration
# Generated by /kl init

output:
  libraries: ./libraries       # Where processed content is stored

tts:
  voice: nova                  # Voice: alloy, echo, fable, nova, onyx, shimmer
  model: tts-1                 # Model: tts-1 (standard) or tts-1-hd (premium)

processing:
  remove_sponsors: true        # Remove sponsor segments from transcripts
  remove_visual_refs: true     # Remove unexplained visual references
  remove_ads: true             # Remove promotional content and CTAs
```

#### Step I-3: Create Directory Structure

1. Read the `output.libraries` path from the config just created
2. Resolve the path:
   - If starts with `./` or is relative: resolve from project root
   - If starts with `/`: use as-is (absolute)
   - If starts with `~/`: expand to home directory
3. Create the directory if it doesn't exist:
   ```bash
   mkdir -p {resolved_path}
   ```

#### Step I-4: Validate Dependencies

Check each dependency and report status:

```
=== Knowledge Library Init ===

Config: config.yaml created
Libraries: {path}/ created

Dependencies:
  [OK] yt-dlp - installed
  [!!] OPENAI_API_KEY - not set
       Set it: export OPENAI_API_KEY="your-key-here"
  [OK] ffmpeg - installed

Setup complete! Run /kl to get started.
```

Check dependencies with:
- `yt-dlp`: `which yt-dlp`
- `OPENAI_API_KEY`: check environment variable is set
- `ffmpeg`: `which ffmpeg`

Missing dependencies show as warnings (not errors) â€” user can set them up later.

---

### Main Menu Flow

#### Step M-1: Prerequisites Check

1. Check if `config.yaml` exists
2. If missing, report:
   ```
   No config.yaml found. Run /kl init to set up your project.
   ```
   And stop.

#### Step M-2: Show Main Menu

```
=== Knowledge Library ===

[N] New       - Extract content from a YouTube URL
[B] Browse    - Access your content library
[P] Pipeline  - Run full Extract -> Refine -> Consume
[R] Refine    - Clean a transcript (remove noise)
[C] Consume   - Convert content to audio
[S] Settings  - View current configuration
[H] Help      - Learn about features
[X] Exit
```

#### Step M-3: Handle Selection

1. **[N] New:** Ask for YouTube URL, then invoke `/pipeline {url}`
2. **[B] Browse:** Invoke `/library`
3. **[P] Pipeline:** Ask for YouTube URL, then invoke `/pipeline {url}`
4. **[R] Refine:** Ask for slug, then invoke `/refine {slug}`
5. **[C] Consume:** Ask for slug, then invoke `/consume {slug}`
6. **[S] Settings:** Display contents of `config.yaml`
7. **[H] Help:** Go to Help Flow
8. **[X] Exit:** End

---

### Help Flow

Display:

```
=== Knowledge Library Help ===

FEATURES:
  Extract   - Pull transcripts from YouTube videos
  Refine    - Remove sponsors, visual refs, and ads
  Consume   - Convert content to audio via OpenAI TTS
  Pipeline  - Run all stages in one session
  Library   - Browse and manage processed content

COMMANDS:
  /kl              Main menu
  /kl init         Initialize project with config.yaml
  /kl help         This help text
  /pipeline {url}  Full pipeline from URL to audio
  /library         Browse content library
  /refine {slug}   Clean a transcript
  /consume {slug}  Convert to audio

CONFIGURATION:
  config.yaml      Project settings (voice, processing rules, paths)
  Edit config.yaml to customize behavior.

REQUIREMENTS:
  yt-dlp           For YouTube transcript extraction
  OPENAI_API_KEY   For text-to-speech generation
  ffmpeg           For concatenating long audio content
```

</instructions>

## Error Handling

| Condition | Action |
|-----------|--------|
| No config.yaml (main menu) | Direct to /kl init |
| Config exists (init) | Prompt: Keep/Reset/Cancel |
| Missing yt-dlp | Warning with install instructions |
| Missing OPENAI_API_KEY | Warning with setup instructions |
| Missing ffmpeg | Warning with install instructions |
| Invalid output path | Show path error with resolution options |

## Examples

```bash
# Initialize a new project
/kl init

# Open main menu
/kl

# Get help
/kl help
```
